apiVersion: kuttl.dev/v1beta1
kind: TestAssert
timeout: 90
---
apiVersion: vm.neon.tech/v1
kind: VirtualMachineMigration
metadata:
  name: example
status:
  phase: Succeeded
---
apiVersion: vm.neon.tech/v1
kind: VirtualMachine
metadata:
  name: example
status:
  phase: Running
  restartCount: 0
  conditions:
    - type: Available
      status: "True"
# original spec had no affinity but it should be added during the migration to prevent the VM from being scheduled on a different architecture      
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/arch
            operator: In
            values:
            - amd64
          - key: kubernetes.io/os
            operator: In
            values:
            - linux
---
apiVersion: v1
kind: pod
metadata:
  name: workload
status:
  phase: Running
